import paho.mqtt.client as mqtt
#from pymongo import MongoClient
import json
import datetime

#mongo_client = MongoClient('mongo_container',27017)
#db = mongo_client.sensor
#sensors = db.sensors

def on_connect(client, userdata, flags, rc):
    client.subscribe("sensors")
    print("subscribed to topic: sensors")

def on_message(client, userdata, message):
        try:
          data = json.loads(str(message.payload.decode("utf-8")))
        except:
            print("error...")
        data['timestamp'] = datetime.datetime.utcnow()
#       sensors.insert_one(data)
        print(data)

def on_message_1(client, userdata, message):
    print("message received " ,str(message.payload.decode("utf-8")))
    print("message topic=",message.topic)
    print("message qos=",message.qos)
    print("message retain flag=",message.retain)
        
client = mqtt.Client()
client.connect("127.0.0.1")
client.on_connect = on_connect
client.on_message = on_message
#client.connect("mosquitto")
client.loop_forever()

